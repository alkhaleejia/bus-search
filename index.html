<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø­Ø±Ùƒ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø­Ø§ÙÙ„Ø§Øª - Gare.ma</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .header-search { background: #004d99; color: white; padding: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
        .main-content { display: flex; flex: 1; overflow: hidden; padding: 20px; gap: 20px; }
        .results-table { flex: 3; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); overflow-y: auto; }
        .agency-sidebar { flex: 1; background: #fff; border-right: 4px solid #004d99; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fa; position: sticky; top: 0; padding: 12px; border-bottom: 2px solid #eee; }
        td { padding: 12px; text-align: center; border-bottom: 1px solid #eee; cursor: pointer; }
        tr:hover { background: #f1f7ff; }
        select { padding: 10px; border-radius: 5px; border: none; font-size: 16px; }
        .agency-box h3 { color: #004d99; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .phone-link { display: block; background: #28a745; color: white; text-decoration: none; padding: 10px; text-align: center; border-radius: 5px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="header-search">
    <select id="compFilter"><option value="">ÙƒÙ„ Ø§Ù„Ø´Ø±ÙƒØ§Øª</option></select>
    <select id="startFilter"><option value="">Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø¥Ù†Ø·Ù„Ø§Ù‚</option></select>
    <select id="endFilter"><option value="">Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„ÙˆØµÙˆÙ„</option></select>
    <button onclick="filterData()" style="cursor:pointer; font-weight:bold;">Ø¨Ù€Ø­Ù€Ø«</button>
</div>

<div class="main-content">
    <div class="results-table">
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ø´Ø±ÙƒØ©</th>
                    <th>Ø§Ù„Ø¥Ù†Ø·Ù„Ø§Ù‚</th>
                    <th>ÙˆÙ‚Øª Ø§Ù„Ø¥Ù†Ø·Ù„Ø§Ù‚</th>
                    <th>Ø§Ù„ÙˆØµÙˆÙ„</th>
                    <th>ÙˆÙ‚Øª Ø§Ù„ÙˆØµÙˆÙ„</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>
    </div>

    <div class="agency-sidebar" id="agencySidebar">
        <div class="agency-box">
            <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆÙƒØ§Ù„Ø©</h3>
            <p id="agencyInfo">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø±Ø­Ù„Ø© Ù„Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆÙƒØ§Ù„Ø© ÙÙŠ Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ø¥Ù†Ø·Ù„Ø§Ù‚.</p>
        </div>
    </div>
</div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwOCA6LH0-yL-Tac_0mJSVGkZXFbUAwJDwx0VhH8z_AAyBRjsCyb2MDc3COe66BaA9MCA/exec?type=json";
    let allData = [];

    async function fetchData() {
        const response = await fetch(API_URL);
        const data = await response.json();
        allData = data.results;
        
        // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙÙ„Ø§ØªØ±
        const startSelect = document.getElementById('startFilter');
        data.cities.forEach(c => startSelect.add(new Option(c.City_Name_AR, c.City_ID)));
        
        const compSelect = document.getElementById('compFilter');
        data.companies.forEach(c => compSelect.add(new Option(c.Company_Name, c.Company_ID)));
    }

    function filterData() {
        const comp = document.getElementById('compFilter').value;
        const start = document.getElementById('startFilter').value;
        const end = document.getElementById('endFilter').value;

        const filtered = allData.filter(r => {
            return (!comp || r.company === comp) && 
                   (!start || r.startCityId === start) &&
                   (!end || r.endCityName === document.getElementById('endFilter').options[document.getElementById('endFilter').selectedIndex].text);
        });

        renderTable(filtered);
    }

    function renderTable(data) {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';
        data.forEach(r => {
            const row = tbody.insertRow();
            row.innerHTML = `<td>${r.company}</td><td>${r.startCityName}</td><td>${r.startTime}</td><td>${r.endCityName}</td><td>${r.endTime}</td>`;
            row.onclick = () => showAgency(r.agencyDetails);
        });
    }

    function showAgency(agency) {
        const box = document.getElementById('agencyInfo');
        if(!agency) {
            box.innerHTML = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆÙƒØ§Ù„Ø© Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø­Ù„Ø©.";
            return;
        }
        box.innerHTML = `
            <strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${agency.Agency_Name_AR}<br>
            <strong>Ø§Ù„Ù‡Ø§ØªÙ 1:</strong> ${agency.Phone_1}<br>
            <strong>Ø§Ù„Ù‡Ø§ØªÙ 2:</strong> ${agency.Phone_2 || '-'}<br>
            <a href="${agency.Phone_1}" class="phone-link">Ø§ØªØµØ§Ù„ Ø§Ù„Ø¢Ù†</a>
            <br>
            <a href="${agency.Map_Link}" target="_blank" style="color:#004d99">ğŸ“ Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</a>
        `;
    }

    window.onload = fetchData;
</script>
</body>
</html>
